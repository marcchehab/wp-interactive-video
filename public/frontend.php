<?php

add_shortcode('ivvideo', 'create_ivvideo_comments_shortcode');
/**
 * @param $atts
 * @return string
 */
function create_ivvideo_comments_shortcode($atts)
{
    ob_start();

    // Check if VC is deactivated and, if so, get oembed
    if (($options['iv_useiv'] == "false" && (!isset($atts['default']) || $atts['default'] == "true")) || ($atts['useiv'] == "false" && $atts['default'] == "false")) {
        return wp_oembed_get('https://www.youtube.com/watch?v='.$atts['videoid']);
    } else {

        global $wp;
        $videoid = $atts['videoid'];
        $embedid = $atts['embedid'];
        $current_user = wp_get_current_user();
        //Creating WP-Post, if necessary
        $args = array('name' => $videoid, 'post_type' => 'iv-video');
        $slug_query = new WP_Query($args);
        $post_exists = $slug_query->posts[0]->ID;
        if (!$post_exists) {
            $my_post = array(
                'post_title' => wp_strip_all_tags($videoid),
                'post_status' => 'publish',
                'post_type' => 'iv-video'
            );
            // Insert the post into the database
            $post_id = wp_insert_post($my_post);
            $post_obj = get_post($post_id, OBJECT);
            $videoid = $post_obj->post_name;
        }
        $options = get_option('iv_options');
        $post_obj = get_page_by_title($videoid, OBJECT, 'iv-video');

        // Create string of data-attributes of $atts
        $attsstring = '';
        foreach ($atts as $key => $value) {
            $attsstring .= ' data-' . $key . '=' . $value;
        }

        ?>

        <?php
        $classesstring = 'iv_containers sync';
        if ($options['iv_moderatorreservetime'] == 61) $classesstring .= ' onlymods';
        // This generates the player, or displays teaser as placeholder if lazyloading video is activated.
        if (($options['iv_lazyloadv'] && (!isset($atts['default']) || $atts['default'] == "true")) || ($atts['lazyloadv'] == "true" && $atts['default'] == "false")) { ?>
            <div id="<?php echo $embedid; ?>" class="<?php echo $classesstring; ?> lazyload"<?php echo $attsstring; ?>>
                <div class="iv_placeholderwrappers">
                    <div class="iv_placeholders">
                    <img src="https://img.youtube.com/vi/<?php echo $videoid; ?>/hqdefault.jpg"/>
                    <span class="iv_videotitles"></span>
                    <svg
                            xmlns:svg="http://www.w3.org/2000/svg"
                            xmlns="http://www.w3.org/2000/svg"
                            viewBox="0 0 1024 721"
                            version="1.1"
                            class="iv_playarrows">
                        <g>
                            <path class="backgrounds"
                                  d="m 1013,156.3 c 0,0 -10,-70.4 -40.6,-101.4 C 933.6,14.2 890,14 870.1,11.6 727.1,1.3 512.7,1.3 512.7,1.3 l -0.4,0 c 0,0 -214.4,0 -357.4,10.3 C 135,14 91.4,14.2 52.6,54.9 22,85.9 12,156.3 12,156.3 c 0,0 -10.2,82.6 -10.2,165.3 l 0,77.5 c 0,82.7 10.2,165.3 10.2,165.3 0,0 10,70.4 40.6,101.4 38.9,40.7 89.9,39.4 112.6,43.7 81.7,7.8 347.3,10.3 347.3,10.3 0,0 214.6,-0.3 357.6,-10.7 20,-2.4 63.5,-2.6 102.3,-43.3 30.6,-31 40.6,-101.4 40.6,-101.4 0,0 10.2,-82.7 10.2,-165.3 l 0,-77.5 c 0,-82.7 -10.2,-165.3 -10.2,-165.3 z"/>
                            <path
                                    class="arrows"
                                    d="m 406.75958,492.75403 0,-287 276.00001,143.99999 z"/>
                        </g>
                    </svg>
                    <div class="iv_batches">
                        <svg
                                xmlns:svg="http://www.w3.org/2000/svg"
                                xmlns="http://www.w3.org/2000/svg"
                                width="100%"
                                height="100%"
                                viewBox="0 0 100 100"
                                id="svg4139"
                                version="1.1">
                            <g
                                    style="stroke:none"
                                    id="layer1"
                                    transform="matrix(1.012518,0,0,1.0124179,-0.63282375,-964.81144)">
                                <path
                                        style="fill:var(--iv_batches_color);fill-opacity:1;"
                                        d="M 99.388672,0.61523438 A 99.406105,99.406105 0 0 0 0.625,99.388672 l 98.763672,0 0,-98.77343762 z"
                                        id="path4687"
                                        class="batchfills"
                                        transform="translate(0,952.36223)"/>
                                <g id="text4716"
                                   style="fill:var(--iv_batches_fontcolor);fill-opacity:1;">
                                    <path
                                            d="m 16.974361,1045.8295 -0.0038,0.05 -12.6607182,1.2823 -0.2340273,3.041 18.2864435,-2.3789 0.237864,-3.0909 -17.7071299,-5.1488 -0.2340274,3.041 12.3154313,3.2044 z"
                                            id="path4732"/>
                                    <path
                                            d="m 23.402407,1038.8388 -13.288364,-2.0789 -0.4327857,2.7663 13.2883627,2.0789 0.432787,-2.7663 z m -15.3137275,-2.3958 -2.5193551,-0.3941 -0.4327861,2.7663 2.5193551,0.3942 0.4327861,-2.7664 z"
                                            id="path4734"/>
                                    <path
                                            d="m 25.346633,1030.1226 -17.5570231,-4.1897 -0.6499232,2.7236 5.5929573,1.3346 q -0.414773,0.338 -0.733382,0.5961 -0.342927,0.2523 -0.588585,0.5278 -0.269975,0.2697 -0.42997,0.617 -0.178509,0.3172 -0.282961,0.755 -0.307553,1.2888 0.436611,2.2631 0.749968,0.95 2.549441,1.3794 l 6.273839,1.4972 q 1.799473,0.4294 2.897614,-0.08 1.103943,-0.5333 1.411496,-1.8221 0.243721,-1.0214 0.02404,-1.7163 -0.244003,-0.7008 -0.932624,-1.5848 l 0.0116,-0.049 1.361764,0.3249 0.615106,-2.5776 z m -3.324816,2.0852 q 0.193157,0.483 0.300652,0.8942 0.107494,0.4112 0.0088,0.8246 -0.133466,0.5593 -0.639705,0.8497 -0.500436,0.2661 -1.789248,-0.041 l -4.863441,-1.1606 q -1.288812,-0.3075 -1.615161,-0.771 -0.320546,-0.4877 -0.18708,-1.047 0.09865,-0.4134 0.38023,-0.7317 0.281581,-0.3183 0.672036,-0.6621 l 7.732872,1.8453 z"
                                            id="path4736"/>
                                    <path
                                            d="m 18.40635,1024.2615 -0.657737,-0.2396 q -1.10406,-0.4021 -1.436989,-0.949 -0.356421,-0.5555 -0.09977,-1.2603 0.256655,-0.7047 0.88684,-0.9009 0.606695,-0.2047 1.710754,0.1974 l 0.657738,0.2395 -1.06084,2.9129 z m 1.831092,-5.6123 q -1.033587,-0.3764 -1.979736,-0.4815 -0.94615,-0.1051 -1.736564,0.1657 -0.813905,0.2623 -1.425094,0.9178 -0.63468,0.6468 -1.045327,1.7744 -0.410648,1.1275 -0.340609,2.031 0.04655,0.895 0.501137,1.6193 0.431098,0.7157 1.223254,1.2437 0.792157,0.5279 1.825744,0.9044 l 3.711518,1.3517 q 1.033588,0.3764 1.979737,0.4815 0.94615,0.1052 1.760055,-0.1572 0.790414,-0.2708 1.425094,-0.9177 0.611189,-0.6554 1.021836,-1.783 0.402093,-1.104 0.346989,-1.9755 -0.04655,-0.8949 -0.454156,-1.6021 -0.431098,-0.7158 -1.176273,-1.2266 -0.73662,-0.5344 -1.738162,-0.9257 l -0.958177,2.6309 0.281887,0.1027 q 1.104059,0.4021 1.46048,0.9576 0.33293,0.547 0.07628,1.2517 -0.256655,0.7047 -0.86335,0.9094 -0.630185,0.1962 -1.734244,-0.2059 l -1.832269,-0.6673 2.019017,-5.5438 -2.349062,-0.8555 z"
                                            id="path4738"/>
                                    <path
                                            d="m 27.326593,1014.2802 q 1.05071,0.526 1.341126,1.1187 0.268061,0.5815 -0.06766,1.2522 -0.335719,0.6706 -0.96188,0.8045 -0.648516,0.1227 -1.699226,-0.4033 l -4.426396,-2.2157 q -1.05071,-0.526 -1.31877,-1.1075 -0.290416,-0.5927 0.0453,-1.2633 0.335719,-0.6707 0.984235,-0.7934 0.62616,-0.1339 1.67687,0.3921 l 4.426396,2.2157 z m -3.088099,5.0521 q 0.983643,0.4924 1.911513,0.7053 0.927871,0.2128 1.766473,0.045 0.816247,-0.1785 1.520871,-0.7484 0.682268,-0.581 1.219419,-1.6541 0.53715,-1.0731 0.593463,-1.9675 0.03396,-0.9056 -0.312283,-1.666 -0.368596,-0.7716 -1.095035,-1.3869 -0.726439,-0.6152 -1.710082,-1.1076 l -3.532174,-1.7681 q -0.983644,-0.4924 -1.911514,-0.7053 -0.92787,-0.2128 -1.744118,-0.034 -0.838602,0.1673 -1.52087,0.7484 -0.704624,0.5699 -1.241774,1.6429 -0.537151,1.0731 -0.571108,1.9787 -0.05631,0.8944 0.312283,1.666 0.34624,0.7604 1.072679,1.3757 0.726439,0.6152 1.710083,1.1076 l 3.532174,1.7681 z"
                                            id="path4740"/>
                                    <path
                                            d="m 27.778318,998.79965 -1.102801,-0.73448 q -0.832303,-0.55432 -1.747672,-0.80351 -0.901511,-0.27001 -1.78205,-0.1656 -0.866681,0.0836 -1.684633,0.59013 -0.817952,0.50654 -1.455422,1.46369 -0.679044,1.01952 -0.865819,1.97652 -0.193726,0.9223 -0.0061,1.7681 0.201454,0.825 0.742615,1.5459 0.555019,0.7 1.345707,1.2267 l 7.740415,5.1551 q 0.790688,0.5266 1.650583,0.7689 0.873754,0.2215 1.712678,0.089 0.852782,-0.1529 1.649927,-0.6733 0.790195,-0.5551 1.469239,-1.5747 0.637469,-0.9571 0.831194,-1.8794 0.172918,-0.9361 -0.04239,-1.7403 -0.201455,-0.8251 -0.756474,-1.5251 -0.541161,-0.7209 -1.331848,-1.2475 l -1.727028,-1.1502 -1.718397,2.5801 1.810259,1.2057 q 0.728265,0.485 0.943454,1.0188 0.215189,0.5338 -0.255984,1.2413 -0.526605,0.7907 -1.115961,0.8187 -0.610164,0.014 -1.463275,-0.5541 l -7.615569,-5.072 q -0.853111,-0.5682 -1.054442,-1.1228 -0.222139,-0.5685 0.304466,-1.3592 0.332593,-0.4993 1.018997,-0.5829 0.665596,-0.0973 1.622744,0.5401 l 1.165224,0.7761 1.718396,-2.58015 z"
                                            id="path4742"/>
                                    <path
                                            d="m 38.819223,997.71241 q 0.89074,0.76629 1.027865,1.41191 0.118172,0.62931 -0.370951,1.19788 -0.489124,0.5685 -1.129029,0.5457 -0.658856,-0.039 -1.549597,-0.8055 l -3.752481,-3.22817 q -0.890741,-0.76629 -1.008913,-1.39561 -0.137125,-0.64562 0.351999,-1.21417 0.489124,-0.56856 1.14798,-0.52941 0.639905,0.0229 1.530645,0.78915 l 3.752482,3.22822 z m -4.226812,4.14659 q 0.833885,0.7174 1.681843,1.15 0.847958,0.4327 1.702047,0.475 0.835137,0.026 1.657452,-0.355 0.803363,-0.3971 1.585961,-1.3068 0.782598,-0.9097 1.055307,-1.7634 0.253757,-0.86997 0.103394,-1.69187 -0.169316,-0.8382 -0.7238,-1.61202 -0.554484,-0.77382 -1.388369,-1.4912 l -2.994404,-2.57605 q -0.833885,-0.71738 -1.681843,-1.15007 -0.847959,-0.43269 -1.683095,-0.4586 -0.854089,-0.0422 -1.657452,0.35493 -0.822315,0.38085 -1.604913,1.29055 -0.782598,0.90969 -1.036355,1.77966 -0.27271,0.85368 -0.103394,1.69188 0.150363,0.8219 0.704848,1.59572 0.554484,0.77382 1.388368,1.4912 l 2.994405,2.57607 z"
                                            id="path4744"/>
                                    <path
                                            d="m 50.317985,992.51359 -6.883591,-7.99492 q 0.131595,-0.57516 0.290547,-1.04191 0.158951,-0.46676 0.499967,-0.76037 0.32207,-0.2773 0.693586,-0.26728 0.37415,-0.0252 0.700387,0.35367 l 6.802032,7.90019 2.121874,-1.82692 -7.095646,-8.24121 q -0.864527,-1.0041 -1.846459,-1.14835 -0.981933,-0.14425 -1.986033,0.72028 -0.28418,0.24467 -0.500479,0.52988 -0.23261,0.26625 -0.386295,0.66249 -0.151051,0.36098 -0.261068,0.88457 -0.107382,0.48834 -0.176364,1.17453 -0.879305,-0.33158 -1.483943,-0.30583 -0.62095,0.007 -1.416653,0.6919 -0.378906,0.32623 -0.581526,0.66564 -0.218932,0.32045 -0.353671,0.70038 -0.13474,0.37993 -0.204232,0.83564 -0.06949,0.45571 -0.16583,1.0335 l -0.880839,-1.02305 -2.008202,1.72906 8.775764,10.19257 2.121873,-1.82693 -6.883591,-7.99491 q 0.15054,-0.59147 0.309492,-1.05823 0.158952,-0.46675 0.499967,-0.76036 0.32207,-0.2773 0.693587,-0.26728 0.355204,-0.009 0.681441,0.36998 l 6.802032,7.90019 2.121873,-1.82692 z"
                                            id="path4746"/>
                                    <path
                                            d="m 62.258491,984.33903 -5.285939,-9.13025 q 0.235714,-0.54089 0.478261,-0.97019 0.242547,-0.42929 0.631989,-0.65476 0.367806,-0.21294 0.731057,-0.13437 0.372361,0.0444 0.62288,0.47712 l 5.223309,9.02207 2.423193,-1.40291 -5.448776,-9.4115 q -0.663874,-1.14669 -1.602179,-1.47009 -0.938304,-0.32339 -2.084994,0.34048 -0.324534,0.18789 -0.589856,0.42816 -0.277847,0.21863 -0.502174,0.57961 -0.215218,0.32681 -0.420187,0.82101 -0.195859,0.46005 -0.39058,1.12164 -0.802797,-0.48851 -1.401763,-0.57505 -0.611492,-0.10818 -1.520189,0.41791 -0.432713,0.25052 -0.694618,0.54659 -0.274431,0.27443 -0.477123,0.62288 -0.202692,0.34844 -0.35528,0.78344 -0.152588,0.43499 -0.354141,0.98499 l -0.676399,-1.16833 -2.293379,1.32775 6.738946,11.63998 2.423193,-1.4029 -5.285939,-9.13025 q 0.25735,-0.55342 0.499896,-0.98271 0.242547,-0.4293 0.631989,-0.65477 0.367806,-0.21294 0.731057,-0.13437 0.350726,0.0569 0.601244,0.48965 l 5.22331,9.02207 2.423192,-1.4029 z"
                                            id="path4748"/>
                                    <path
                                            d="m 67.039559,972.60791 -0.255666,-0.65164 q -0.429154,-1.09383 -0.239407,-1.70538 0.180616,-0.63483 0.878802,-0.90875 0.698186,-0.27393 1.262302,0.0687 0.554984,0.31937 0.984138,1.41319 l 0.255666,0.65164 -2.885835,1.13224 z m 5.419348,-2.34109 q -0.401761,-1.024 -0.949061,-1.80292 -0.547301,-0.77892 -1.273435,-1.19226 -0.735265,-0.43662 -1.631103,-0.46112 -0.904968,-0.0478 -2.022065,0.39051 -1.117098,0.43829 -1.748138,1.0887 -0.640172,0.62714 -0.882367,1.44726 -0.251325,0.79684 -0.122937,1.74012 0.128389,0.94327 0.53015,1.96728 l 1.442687,3.67711 q 0.401761,1.02401 0.949061,1.80292 0.547301,0.77892 1.282566,1.21554 0.726134,0.41334 1.631103,0.46112 0.895837,0.0245 2.012934,-0.41379 1.093825,-0.42915 1.710723,-1.04716 0.640172,-0.62714 0.900629,-1.40072 0.251325,-0.79684 0.141199,-1.69357 -0.08685,-0.90586 -0.456212,-1.91572 l -2.60656,1.02266 0.109571,0.27928 q 0.429154,1.09382 0.248538,1.72865 -0.189747,0.61155 -0.887933,0.88548 -0.698186,0.27392 -1.253171,-0.0454 -0.564115,-0.34263 -0.993269,-1.43646 l -0.712212,-1.81528 5.492395,-2.1549 -0.913093,-2.32729 z"
                                            id="path4750"/>
                                    <path
                                            d="m 78.662865,977.55437 -2.700631,-10.19849 q 0.393747,-0.46633 0.74059,-0.81679 0.346843,-0.35047 0.78185,-0.46566 0.435006,-0.11519 0.76484,0.0561 0.323433,0.14711 0.451425,0.63045 l 2.668633,10.07765 2.706706,-0.71675 -2.783825,-10.51266 q -0.339178,-1.28085 -1.135342,-1.84587 -0.771996,-0.57142 -1.859513,-0.28344 -0.580008,0.15359 -0.983017,0.38962 -0.409408,0.21186 -0.720716,0.50119 -0.311309,0.28933 -0.572852,0.66893 -0.261543,0.37959 -0.600556,0.85729 l -0.345578,-1.30502 -2.561705,0.67836 3.442984,13.00186 2.706707,-0.71675 z"
                                            id="path4752"/>
                                    <path
                                            d="m 83.110206,965.04499 1.424266,8.25301 q 0.263595,1.52742 1.22876,2.12194 0.960913,0.56989 2.512971,0.30204 0.517352,-0.0893 0.804479,-0.18957 0.291379,-0.0757 0.549618,-0.19633 l -0.408148,-2.36504 -0.911526,0.15731 q -0.936161,0.16155 -1.123229,-0.92242 l -1.317978,-7.63711 1.847688,-0.31887 -0.391142,-2.26649 -1.847687,0.31886 -0.616474,-3.5722 -2.759213,0.47618 0.616473,3.57219 -1.527422,0.2636 0.391142,2.2665 1.527422,-0.2636 z"
                                            id="path4754"/>
                                    <path
                                            d="m 95.726,964.49997 q -0.468819,-1.53833 -1.631434,-2.43497 -1.13772,-0.89893 -2.780693,-0.74682 -0.796593,0.0738 -1.443366,0.40982 -0.649077,0.31116 -1.12805,0.83254 -0.454079,0.51907 -0.690571,1.21886 -0.213904,0.67258 -0.14015,1.46917 0.08528,0.92106 0.523216,1.58351 0.462831,0.66014 1.088393,1.17968 0.650455,0.51724 1.366372,0.92799 0.715917,0.41074 1.329954,0.80582 0.638932,0.39276 1.058431,0.85606 0.442088,0.4361 0.495098,1.00865 0.05301,0.57255 -0.267841,0.90354 -0.320851,0.33099 -0.868509,0.3817 -0.945954,0.0876 -1.401871,-0.49788 -0.433328,-0.61266 -0.636159,-1.44751 l -2.377336,0.89799 q 0.487257,1.73748 1.624978,2.63642 1.135416,0.87405 2.977537,0.70349 0.84638,-0.0784 1.547549,-0.36925 0.701169,-0.29088 1.182447,-0.78736 0.478973,-0.52138 0.690572,-1.21886 0.236492,-0.69978 0.153519,-1.59595 -0.09219,-0.99574 -0.559633,-1.70567 -0.444853,-0.73713 -1.095308,-1.25436 -0.627867,-0.54444 -1.343783,-0.95518 -0.718222,-0.43564 -1.354848,-0.80352 -0.614038,-0.39507 -1.051517,-0.78138 -0.414889,-0.41351 -0.46329,-0.93628 -0.0484,-0.52276 0.249862,-0.82655 0.323156,-0.3061 0.870814,-0.35681 1.294463,-0.11985 1.747608,1.52036 L 95.726,964.49997 Z"
                                            id="path4756"/>
                                </g>
                            </g>
                        </svg>
                    </div>
                </div>
                </div>
            </div>
        <?php } else { ?>
            <div id="<?php echo $embedid; ?>" class="iv_containers sync"<?php echo $attsstring; ?>>
                <?php echo create_iv_player($atts); ?>
            </div>
        <?php }
        $out = ob_get_contents();
        ob_end_clean();
        return $out;
    }
}

// Returns the HTML for the player. Can be called by normal pageload or AJAX request.
add_action('wp_ajax_iv_fetchplayer', 'iv_ajaxfetchplayer');
add_action('wp_ajax_nopriv_iv_fetchplayer', 'iv_ajaxfetchplayer');
function iv_ajaxfetchplayer() {
    $atts = array();
    if (isset($_POST['iv_videoid'])) $atts['videoid'] = $_POST['iv_videoid'];
    if (isset($_POST['iv_embedid'])) $atts['embedid'] = $_POST['iv_embedid'];
    if (isset($_POST['iv_default'])) $atts['default'] = $_POST['iv_default'];
    if (isset($_POST['iv_useiv'])) $atts['useiv'] = $_POST['iv_useiv'];
    if (isset($_POST['iv_preloadc'])) $atts['preloadc'] = $_POST['iv_preloadc'];
    if (isset($_POST['iv_lazyloadv'])) $atts['lazyloadv'] = $_POST['iv_lazyloadv'];

    echo create_iv_player($atts);

    wp_die();
}
function create_iv_player($atts) {
    ob_start();
    global $wp;
    $videoid = $atts['videoid'];
    $embedid = $atts['embedid'];
    $options = get_option('iv_options');
    $post_obj = get_page_by_title($videoid, OBJECT, 'iv-video');
    ?>
<div id="<?php echo $embedid; ?>_playercontainer" class="iv_playercontainers">
    <div id="<?php echo $embedid; ?>_player" class="iv_players"></div>
    <div class="iv_controllayers">
        <div class="iv_controlinterfaces">
            <div class="iv_shades fading"></div>
            <svg id="<?php echo $embedid; ?>_histogramcanvas" class="iv_histogramcanvases fading" viewBox="0 0 100 50" preserveAspectRatio="none"></svg>
            <div class="iv_clickcanvas"></div>
            <div class="iv_controlpanels fading">
                <div class="iv_playpausebuttons buttons pausebutton"><svg height="16" width="16" id="d" viewBox="0 0 300 300">
                        <polygon class="shapes1" points="0,0 110,0 110,300 0,300">
                            <animate begin="indefinite" attributeName="points" dur="300ms" to="0,0 150,75 150,225 0,300" fill="freeze"/>

                        </polygon>
                        <polygon class="shapes2" points="190,0 300,0 300,300 190,300">

                            <animate begin="indefinite" attributeName="points" dur="300ms" to="150,75 300,150 300,150 150,225" fill="freeze"/>

                        </polygon>
                    </svg></div>
                <div class="iv_currenttimes"><span class="curtimes"></span> / <span class="durations"></span></div>
                <div class="iv_volumebuttons buttons"><span class="dashicons dashicons-controls-volumeon"></span></div>
                <span style="float:right">
                        <div class="iv_openclosebuttons buttons"><span class="commentsnumber"><?php
                                if (get_comments_number($post_obj->ID)>=100) {
                                    echo "+99";
                                } else {
                                    echo get_comments_number($post_obj->ID);
                                } ?></span><svg
                                    xmlns="http://www.w3.org/2000/svg"
                                    viewBox="0 0 70 10"
                                    id="svg2"
                                    version="1.1">
      <g
              id="layer1"
              transform="matrix(0.33472345,0,0,0.33472345,-52.501016,-128.38584)">

        <g
                id="text4136"
                class="iv_fonts"
                style="fill-opacity:1;">
      <path
              class="fletches"
              d="m 145.1865,395.12526 -0.08,0 -3.6,6.53923 -4.88,0 6.04,-9.4238 4.96,0 6.04,9.4238 -4.88,0 -3.6,-6.53923 z" />
          <path
                  id="V" class="capitalletters"
                  d="m 166.5038,404.09564 -0.08,0 -3.6,-20.04 -4.88,0 6.04,28.88 4.96,0 6.04,-28.88 -4.88,0 -3.6,20.04 z" />
          <path
                  id="path4139"
                  d="m 179.95818,412.93564 0,-21.52 -4.48,0 0,21.52 4.48,0 z m 0,-24.8 0,-4.08 -4.48,0 0,4.08 4.48,0 z" />
          <path
                  id="path4141"
                  d="m 195.74443,412.93564 0,-28.88 -4.48,0 0,9.2 q -0.68,-0.52 -1.2,-0.92 -0.52,-0.44 -1.04,-0.72 -0.52,-0.32 -1.12,-0.44 -0.56,-0.16 -1.28,-0.16 -2.12,0 -3.36,1.52 -1.2,1.52 -1.2,4.48 l 0,10.32 q 0,2.96 1.2,4.48 1.24,1.52 3.36,1.52 1.68,0 2.68,-0.6 1,-0.64 2.12,-2.04 l 0.08,0 0,2.24 4.24,0 z m -4.48,-4.4 q -0.68,0.48 -1.28,0.8 -0.6,0.32 -1.28,0.32 -0.92,0 -1.56,-0.68 -0.6,-0.68 -0.6,-2.8 l 0,-8 q 0,-2.12 0.6,-2.8 0.64,-0.68 1.56,-0.68 0.68,0 1.28,0.32 0.6,0.32 1.28,0.8 l 0,12.72 z" />
          <path
                  id="path4143"
                  d="m 202.2388,399.33564 0,-1.12 q 0,-1.88 0.64,-2.68 0.64,-0.84 1.84,-0.84 1.2,0 1.84,0.84 0.64,0.8 0.64,2.68 l 0,1.12 -4.96,0 z m 9.44,-0.32 q 0,-1.76 -0.36,-3.24 -0.36,-1.48 -1.2,-2.52 -0.84,-1.08 -2.16,-1.64 -1.32,-0.6 -3.24,-0.6 -1.92,0 -3.24,0.6 -1.32,0.56 -2.16,1.64 -0.84,1.04 -1.2,2.52 -0.36,1.48 -0.36,3.24 l 0,6.32 q 0,1.76 0.36,3.24 0.36,1.48 1.2,2.56 0.84,1.04 2.16,1.64 1.32,0.56 3.24,0.56 1.88,0 3.16,-0.56 1.32,-0.56 2.16,-1.56 0.84,-1.04 1.2,-2.44 0.4,-1.4 0.44,-3.12 l -4.48,0 0,0.48 q 0,1.88 -0.64,2.72 -0.64,0.8 -1.84,0.8 -1.2,0 -1.84,-0.8 -0.64,-0.84 -0.64,-2.72 l 0,-3.12 9.44,0 0,-4 z" />
          <path
                  id="path4145"
                  d="m 222.89318,406.13564 q 0,1.88 -0.64,2.72 -0.64,0.8 -1.84,0.8 -1.2,0 -1.84,-0.8 -0.64,-0.84 -0.64,-2.72 l 0,-7.92 q 0,-1.88 0.64,-2.68 0.64,-0.84 1.84,-0.84 1.2,0 1.84,0.84 0.64,0.8 0.64,2.68 l 0,7.92 z m -9.44,-0.8 q 0,1.76 0.36,3.24 0.36,1.48 1.2,2.56 0.84,1.04 2.16,1.64 1.32,0.56 3.24,0.56 1.92,0 3.24,-0.56 1.32,-0.6 2.16,-1.64 0.84,-1.08 1.2,-2.56 0.36,-1.48 0.36,-3.24 l 0,-6.32 q 0,-1.76 -0.36,-3.24 -0.36,-1.48 -1.2,-2.52 -0.84,-1.08 -2.16,-1.64 -1.32,-0.6 -3.24,-0.6 -1.92,0 -3.24,0.6 -1.32,0.56 -2.16,1.64 -0.84,1.04 -1.2,2.52 -0.36,1.48 -0.36,3.24 l 0,6.32 z" />
          <path
                  id="C" class="capitalletters"
                  d="m 244.58755,393.69564 0,-2.12 q 0,-1.6 -0.48,-3.04 -0.44,-1.44 -1.36,-2.52 -0.88,-1.08 -2.28,-1.72 -1.4,-0.64 -3.24,-0.64 -1.96,0 -3.4,0.6 -1.4,0.56 -2.36,1.56 -0.92,1 -1.4,2.36 -0.44,1.36 -0.44,2.88 l 0,14.88 q 0,1.52 0.44,2.88 0.48,1.36 1.4,2.36 0.96,1 2.36,1.6 1.44,0.56 3.4,0.56 1.84,0 3.24,-0.56 1.4,-0.6 2.28,-1.6 0.92,-1 1.36,-2.36 0.48,-1.36 0.48,-2.88 l 0,-3.32 -4.96,0 0,3.48 q 0,1.4 -0.52,2.16 -0.52,0.76 -1.88,0.76 -1.52,0 -2.08,-0.76 -0.56,-0.8 -0.56,-2.44 l 0,-14.64 q 0,-1.64 0.56,-2.4 0.56,-0.8 2.08,-0.8 0.96,0 1.68,0.84 0.72,0.8 0.72,2.64 l 0,2.24 4.96,0 z" />
          <path
                  id="path4149"
                  d="m 256.54755,406.13564 q 0,1.88 -0.64,2.72 -0.64,0.8 -1.84,0.8 -1.2,0 -1.84,-0.8 -0.64,-0.84 -0.64,-2.72 l 0,-7.92 q 0,-1.88 0.64,-2.68 0.64,-0.84 1.84,-0.84 1.2,0 1.84,0.84 0.64,0.8 0.64,2.68 l 0,7.92 z m -9.44,-0.8 q 0,1.76 0.36,3.24 0.36,1.48 1.2,2.56 0.84,1.04 2.16,1.64 1.32,0.56 3.24,0.56 1.92,0 3.24,-0.56 1.32,-0.6 2.16,-1.64 0.84,-1.08 1.2,-2.56 0.36,-1.48 0.36,-3.24 l 0,-6.32 q 0,-1.76 -0.36,-3.24 -0.36,-1.48 -1.2,-2.52 -0.84,-1.08 -2.16,-1.64 -1.32,-0.6 -3.24,-0.6 -1.92,0 -3.24,0.6 -1.32,0.56 -2.16,1.64 -0.84,1.04 -1.2,2.52 -0.36,1.48 -0.36,3.24 l 0,6.32 z" />
          <path
                  id="path4151"
                  d="m 276.44193,412.93564 0,-16.88 q 0.76,-0.56 1.44,-0.96 0.68,-0.4 1.4,-0.4 0.68,0 1.12,0.4 0.48,0.36 0.48,1.16 l 0,16.68 4.48,0 0,-17.4 q 0,-2.12 -1.04,-3.32 -1.04,-1.2 -3.16,-1.2 -0.6,0 -1.16,0.12 -0.56,0.08 -1.16,0.4 -0.56,0.28 -1.24,0.8 -0.64,0.48 -1.44,1.24 -0.72,-1.32 -1.48,-1.92 -0.76,-0.64 -2.44,-0.64 -0.8,0 -1.4,0.2 -0.6,0.16 -1.16,0.48 -0.56,0.32 -1.12,0.8 -0.56,0.48 -1.28,1.08 l 0,-2.16 -4.24,0 0,21.52 4.48,0 0,-16.88 q 0.8,-0.56 1.48,-0.96 0.68,-0.4 1.4,-0.4 0.68,0 1.12,0.4 0.44,0.36 0.44,1.16 l 0,16.68 4.48,0 z" />
          <path
                  id="path4153"
                  d="m 301.12068,412.93564 0,-16.88 q 0.76,-0.56 1.44,-0.96 0.68,-0.4 1.4,-0.4 0.68,0 1.12,0.4 0.48,0.36 0.48,1.16 l 0,16.68 4.48,0 0,-17.4 q 0,-2.12 -1.04,-3.32 -1.04,-1.2 -3.16,-1.2 -0.6,0 -1.16,0.12 -0.56,0.08 -1.16,0.4 -0.56,0.28 -1.24,0.8 -0.64,0.48 -1.44,1.24 -0.72,-1.32 -1.48,-1.92 -0.76,-0.64 -2.44,-0.64 -0.8,0 -1.4,0.2 -0.6,0.16 -1.16,0.48 -0.56,0.32 -1.12,0.8 -0.56,0.48 -1.28,1.08 l 0,-2.16 -4.24,0 0,21.52 4.48,0 0,-16.88 q 0.8,-0.56 1.48,-0.96 0.68,-0.4 1.4,-0.4 0.68,0 1.12,0.4 0.44,0.36 0.44,1.16 l 0,16.68 4.48,0 z" />
          <path
                  id="path4155"
                  d="m 316.63943,399.33564 0,-1.12 q 0,-1.88 0.64,-2.68 0.64,-0.84 1.84,-0.84 1.2,0 1.84,0.84 0.64,0.8 0.64,2.68 l 0,1.12 -4.96,0 z m 9.44,-0.32 q 0,-1.76 -0.36,-3.24 -0.36,-1.48 -1.2,-2.52 -0.84,-1.08 -2.16,-1.64 -1.32,-0.6 -3.24,-0.6 -1.92,0 -3.24,0.6 -1.32,0.56 -2.16,1.64 -0.84,1.04 -1.2,2.52 -0.36,1.48 -0.36,3.24 l 0,6.32 q 0,1.76 0.36,3.24 0.36,1.48 1.2,2.56 0.84,1.04 2.16,1.64 1.32,0.56 3.24,0.56 1.88,0 3.16,-0.56 1.32,-0.56 2.16,-1.56 0.84,-1.04 1.2,-2.44 0.4,-1.4 0.44,-3.12 l -4.48,0 0,0.48 q 0,1.88 -0.64,2.72 -0.64,0.8 -1.84,0.8 -1.2,0 -1.84,-0.8 -0.64,-0.84 -0.64,-2.72 l 0,-3.12 9.44,0 0,-4 z" />
          <path
                  id="path4157"
                  d="m 332.57381,412.93564 0,-16.88 q 0.8,-0.56 1.48,-0.96 0.68,-0.4 1.4,-0.4 0.72,0 1.16,0.4 0.44,0.36 0.44,1.16 l 0,16.68 4.48,0 0,-17.4 q 0,-2.12 -1,-3.32 -0.96,-1.2 -2.76,-1.2 -0.96,0 -1.68,0.2 -0.72,0.16 -1.32,0.48 -0.6,0.32 -1.16,0.8 -0.56,0.48 -1.28,1.08 l 0,-2.16 -4.24,0 0,21.52 4.48,0 z" />
          <path
                  id="path4159"
                  d="m 344.50817,395.09564 0,13.4 q 0,2.48 1.36,3.68 1.36,1.16 3.88,1.16 0.84,0 1.32,-0.08 0.48,-0.04 0.92,-0.16 l 0,-3.84 -1.48,0 q -1.52,0 -1.52,-1.76 l 0,-12.4 3,0 0,-3.68 -3,0 0,-5.8 -4.48,0 0,5.8 -2.48,0 0,3.68 2.48,0 z" />
          <path
                  id="path4161"
                  d="m 364.80193,396.73564 q -0.52,-2.52 -2.24,-4.12 -1.68,-1.6 -4.32,-1.6 -1.28,0 -2.36,0.44 -1.08,0.4 -1.92,1.16 -0.8,0.76 -1.28,1.84 -0.44,1.04 -0.44,2.32 0,1.48 0.6,2.6 0.64,1.12 1.56,2.04 0.96,0.92 2.04,1.68 1.08,0.76 2,1.48 0.96,0.72 1.56,1.52 0.64,0.76 0.64,1.68 0,0.92 -0.56,1.4 -0.56,0.48 -1.44,0.48 -1.52,0 -2.16,-1 -0.6,-1.04 -0.8,-2.4 l -3.92,1.08 q 0.52,2.84 2.2,4.44 1.68,1.56 4.64,1.56 1.36,0 2.52,-0.36 1.16,-0.36 2,-1.08 0.84,-0.76 1.28,-1.84 0.48,-1.08 0.48,-2.52 0,-1.6 -0.64,-2.8 -0.6,-1.24 -1.56,-2.16 -0.92,-0.96 -2,-1.72 -1.08,-0.8 -2.04,-1.48 -0.92,-0.72 -1.56,-1.4 -0.6,-0.72 -0.6,-1.56 0,-0.84 0.52,-1.28 0.56,-0.44 1.44,-0.44 2.08,0 2.56,2.68 l 3.8,-0.64 z" />
        </g>
      </g>
    </svg></div>
                        <div class="iv_fullscreenbuttons buttons"><span class="dashicons dashicons-editor-expand"></span></div>
                    </span>
            </div>
            <div class="iv_timelinewrappers fading">
                <div class="iv_timelines">
                    <div id="<?php echo $embedid; ?>_position" class="iv_positions"></div>
                    <div class="thumbs"></div>
                </div>
            </div>
        </div>
        <div class="iv_batches">
            <svg
                    xmlns:svg="http://www.w3.org/2000/svg"
                    xmlns="http://www.w3.org/2000/svg"
                    width="100%"
                    height="100%"
                    viewBox="0 0 100 100"
                    id="svg4139"
                    version="1.1">
                <g
                        style="stroke:none"
                        id="layer1"
                        transform="matrix(1.012518,0,0,1.0124179,-0.63282375,-964.81144)">
                    <path
                            style="fill:var(--iv_batches_color);fill-opacity:1;"
                            d="M 99.388672,0.61523438 A 99.406105,99.406105 0 0 0 0.625,99.388672 l 98.763672,0 0,-98.77343762 z"
                            id="path4687"
                            class="batchfills"
                            transform="translate(0,952.36223)" />
                    <g id="text4716" style="fill:var(--iv_batches_fontcolor);fill-opacity:1;">
                        <path
                                d="m 16.974361,1045.8295 -0.0038,0.05 -12.6607182,1.2823 -0.2340273,3.041 18.2864435,-2.3789 0.237864,-3.0909 -17.7071299,-5.1488 -0.2340274,3.041 12.3154313,3.2044 z"
                                id="path4732" />
                        <path
                                d="m 23.402407,1038.8388 -13.288364,-2.0789 -0.4327857,2.7663 13.2883627,2.0789 0.432787,-2.7663 z m -15.3137275,-2.3958 -2.5193551,-0.3941 -0.4327861,2.7663 2.5193551,0.3942 0.4327861,-2.7664 z"
                                id="path4734" />
                        <path
                                d="m 25.346633,1030.1226 -17.5570231,-4.1897 -0.6499232,2.7236 5.5929573,1.3346 q -0.414773,0.338 -0.733382,0.5961 -0.342927,0.2523 -0.588585,0.5278 -0.269975,0.2697 -0.42997,0.617 -0.178509,0.3172 -0.282961,0.755 -0.307553,1.2888 0.436611,2.2631 0.749968,0.95 2.549441,1.3794 l 6.273839,1.4972 q 1.799473,0.4294 2.897614,-0.08 1.103943,-0.5333 1.411496,-1.8221 0.243721,-1.0214 0.02404,-1.7163 -0.244003,-0.7008 -0.932624,-1.5848 l 0.0116,-0.049 1.361764,0.3249 0.615106,-2.5776 z m -3.324816,2.0852 q 0.193157,0.483 0.300652,0.8942 0.107494,0.4112 0.0088,0.8246 -0.133466,0.5593 -0.639705,0.8497 -0.500436,0.2661 -1.789248,-0.041 l -4.863441,-1.1606 q -1.288812,-0.3075 -1.615161,-0.771 -0.320546,-0.4877 -0.18708,-1.047 0.09865,-0.4134 0.38023,-0.7317 0.281581,-0.3183 0.672036,-0.6621 l 7.732872,1.8453 z"
                                id="path4736" />
                        <path
                                d="m 18.40635,1024.2615 -0.657737,-0.2396 q -1.10406,-0.4021 -1.436989,-0.949 -0.356421,-0.5555 -0.09977,-1.2603 0.256655,-0.7047 0.88684,-0.9009 0.606695,-0.2047 1.710754,0.1974 l 0.657738,0.2395 -1.06084,2.9129 z m 1.831092,-5.6123 q -1.033587,-0.3764 -1.979736,-0.4815 -0.94615,-0.1051 -1.736564,0.1657 -0.813905,0.2623 -1.425094,0.9178 -0.63468,0.6468 -1.045327,1.7744 -0.410648,1.1275 -0.340609,2.031 0.04655,0.895 0.501137,1.6193 0.431098,0.7157 1.223254,1.2437 0.792157,0.5279 1.825744,0.9044 l 3.711518,1.3517 q 1.033588,0.3764 1.979737,0.4815 0.94615,0.1052 1.760055,-0.1572 0.790414,-0.2708 1.425094,-0.9177 0.611189,-0.6554 1.021836,-1.783 0.402093,-1.104 0.346989,-1.9755 -0.04655,-0.8949 -0.454156,-1.6021 -0.431098,-0.7158 -1.176273,-1.2266 -0.73662,-0.5344 -1.738162,-0.9257 l -0.958177,2.6309 0.281887,0.1027 q 1.104059,0.4021 1.46048,0.9576 0.33293,0.547 0.07628,1.2517 -0.256655,0.7047 -0.86335,0.9094 -0.630185,0.1962 -1.734244,-0.2059 l -1.832269,-0.6673 2.019017,-5.5438 -2.349062,-0.8555 z"
                                id="path4738" />
                        <path
                                d="m 27.326593,1014.2802 q 1.05071,0.526 1.341126,1.1187 0.268061,0.5815 -0.06766,1.2522 -0.335719,0.6706 -0.96188,0.8045 -0.648516,0.1227 -1.699226,-0.4033 l -4.426396,-2.2157 q -1.05071,-0.526 -1.31877,-1.1075 -0.290416,-0.5927 0.0453,-1.2633 0.335719,-0.6707 0.984235,-0.7934 0.62616,-0.1339 1.67687,0.3921 l 4.426396,2.2157 z m -3.088099,5.0521 q 0.983643,0.4924 1.911513,0.7053 0.927871,0.2128 1.766473,0.045 0.816247,-0.1785 1.520871,-0.7484 0.682268,-0.581 1.219419,-1.6541 0.53715,-1.0731 0.593463,-1.9675 0.03396,-0.9056 -0.312283,-1.666 -0.368596,-0.7716 -1.095035,-1.3869 -0.726439,-0.6152 -1.710082,-1.1076 l -3.532174,-1.7681 q -0.983644,-0.4924 -1.911514,-0.7053 -0.92787,-0.2128 -1.744118,-0.034 -0.838602,0.1673 -1.52087,0.7484 -0.704624,0.5699 -1.241774,1.6429 -0.537151,1.0731 -0.571108,1.9787 -0.05631,0.8944 0.312283,1.666 0.34624,0.7604 1.072679,1.3757 0.726439,0.6152 1.710083,1.1076 l 3.532174,1.7681 z"
                                id="path4740" />
                        <path
                                d="m 27.778318,998.79965 -1.102801,-0.73448 q -0.832303,-0.55432 -1.747672,-0.80351 -0.901511,-0.27001 -1.78205,-0.1656 -0.866681,0.0836 -1.684633,0.59013 -0.817952,0.50654 -1.455422,1.46369 -0.679044,1.01952 -0.865819,1.97652 -0.193726,0.9223 -0.0061,1.7681 0.201454,0.825 0.742615,1.5459 0.555019,0.7 1.345707,1.2267 l 7.740415,5.1551 q 0.790688,0.5266 1.650583,0.7689 0.873754,0.2215 1.712678,0.089 0.852782,-0.1529 1.649927,-0.6733 0.790195,-0.5551 1.469239,-1.5747 0.637469,-0.9571 0.831194,-1.8794 0.172918,-0.9361 -0.04239,-1.7403 -0.201455,-0.8251 -0.756474,-1.5251 -0.541161,-0.7209 -1.331848,-1.2475 l -1.727028,-1.1502 -1.718397,2.5801 1.810259,1.2057 q 0.728265,0.485 0.943454,1.0188 0.215189,0.5338 -0.255984,1.2413 -0.526605,0.7907 -1.115961,0.8187 -0.610164,0.014 -1.463275,-0.5541 l -7.615569,-5.072 q -0.853111,-0.5682 -1.054442,-1.1228 -0.222139,-0.5685 0.304466,-1.3592 0.332593,-0.4993 1.018997,-0.5829 0.665596,-0.0973 1.622744,0.5401 l 1.165224,0.7761 1.718396,-2.58015 z"
                                id="path4742" />
                        <path
                                d="m 38.819223,997.71241 q 0.89074,0.76629 1.027865,1.41191 0.118172,0.62931 -0.370951,1.19788 -0.489124,0.5685 -1.129029,0.5457 -0.658856,-0.039 -1.549597,-0.8055 l -3.752481,-3.22817 q -0.890741,-0.76629 -1.008913,-1.39561 -0.137125,-0.64562 0.351999,-1.21417 0.489124,-0.56856 1.14798,-0.52941 0.639905,0.0229 1.530645,0.78915 l 3.752482,3.22822 z m -4.226812,4.14659 q 0.833885,0.7174 1.681843,1.15 0.847958,0.4327 1.702047,0.475 0.835137,0.026 1.657452,-0.355 0.803363,-0.3971 1.585961,-1.3068 0.782598,-0.9097 1.055307,-1.7634 0.253757,-0.86997 0.103394,-1.69187 -0.169316,-0.8382 -0.7238,-1.61202 -0.554484,-0.77382 -1.388369,-1.4912 l -2.994404,-2.57605 q -0.833885,-0.71738 -1.681843,-1.15007 -0.847959,-0.43269 -1.683095,-0.4586 -0.854089,-0.0422 -1.657452,0.35493 -0.822315,0.38085 -1.604913,1.29055 -0.782598,0.90969 -1.036355,1.77966 -0.27271,0.85368 -0.103394,1.69188 0.150363,0.8219 0.704848,1.59572 0.554484,0.77382 1.388368,1.4912 l 2.994405,2.57607 z"
                                id="path4744" />
                        <path
                                d="m 50.317985,992.51359 -6.883591,-7.99492 q 0.131595,-0.57516 0.290547,-1.04191 0.158951,-0.46676 0.499967,-0.76037 0.32207,-0.2773 0.693586,-0.26728 0.37415,-0.0252 0.700387,0.35367 l 6.802032,7.90019 2.121874,-1.82692 -7.095646,-8.24121 q -0.864527,-1.0041 -1.846459,-1.14835 -0.981933,-0.14425 -1.986033,0.72028 -0.28418,0.24467 -0.500479,0.52988 -0.23261,0.26625 -0.386295,0.66249 -0.151051,0.36098 -0.261068,0.88457 -0.107382,0.48834 -0.176364,1.17453 -0.879305,-0.33158 -1.483943,-0.30583 -0.62095,0.007 -1.416653,0.6919 -0.378906,0.32623 -0.581526,0.66564 -0.218932,0.32045 -0.353671,0.70038 -0.13474,0.37993 -0.204232,0.83564 -0.06949,0.45571 -0.16583,1.0335 l -0.880839,-1.02305 -2.008202,1.72906 8.775764,10.19257 2.121873,-1.82693 -6.883591,-7.99491 q 0.15054,-0.59147 0.309492,-1.05823 0.158952,-0.46675 0.499967,-0.76036 0.32207,-0.2773 0.693587,-0.26728 0.355204,-0.009 0.681441,0.36998 l 6.802032,7.90019 2.121873,-1.82692 z"
                                id="path4746" />
                        <path
                                d="m 62.258491,984.33903 -5.285939,-9.13025 q 0.235714,-0.54089 0.478261,-0.97019 0.242547,-0.42929 0.631989,-0.65476 0.367806,-0.21294 0.731057,-0.13437 0.372361,0.0444 0.62288,0.47712 l 5.223309,9.02207 2.423193,-1.40291 -5.448776,-9.4115 q -0.663874,-1.14669 -1.602179,-1.47009 -0.938304,-0.32339 -2.084994,0.34048 -0.324534,0.18789 -0.589856,0.42816 -0.277847,0.21863 -0.502174,0.57961 -0.215218,0.32681 -0.420187,0.82101 -0.195859,0.46005 -0.39058,1.12164 -0.802797,-0.48851 -1.401763,-0.57505 -0.611492,-0.10818 -1.520189,0.41791 -0.432713,0.25052 -0.694618,0.54659 -0.274431,0.27443 -0.477123,0.62288 -0.202692,0.34844 -0.35528,0.78344 -0.152588,0.43499 -0.354141,0.98499 l -0.676399,-1.16833 -2.293379,1.32775 6.738946,11.63998 2.423193,-1.4029 -5.285939,-9.13025 q 0.25735,-0.55342 0.499896,-0.98271 0.242547,-0.4293 0.631989,-0.65477 0.367806,-0.21294 0.731057,-0.13437 0.350726,0.0569 0.601244,0.48965 l 5.22331,9.02207 2.423192,-1.4029 z"
                                id="path4748" />
                        <path
                                d="m 67.039559,972.60791 -0.255666,-0.65164 q -0.429154,-1.09383 -0.239407,-1.70538 0.180616,-0.63483 0.878802,-0.90875 0.698186,-0.27393 1.262302,0.0687 0.554984,0.31937 0.984138,1.41319 l 0.255666,0.65164 -2.885835,1.13224 z m 5.419348,-2.34109 q -0.401761,-1.024 -0.949061,-1.80292 -0.547301,-0.77892 -1.273435,-1.19226 -0.735265,-0.43662 -1.631103,-0.46112 -0.904968,-0.0478 -2.022065,0.39051 -1.117098,0.43829 -1.748138,1.0887 -0.640172,0.62714 -0.882367,1.44726 -0.251325,0.79684 -0.122937,1.74012 0.128389,0.94327 0.53015,1.96728 l 1.442687,3.67711 q 0.401761,1.02401 0.949061,1.80292 0.547301,0.77892 1.282566,1.21554 0.726134,0.41334 1.631103,0.46112 0.895837,0.0245 2.012934,-0.41379 1.093825,-0.42915 1.710723,-1.04716 0.640172,-0.62714 0.900629,-1.40072 0.251325,-0.79684 0.141199,-1.69357 -0.08685,-0.90586 -0.456212,-1.91572 l -2.60656,1.02266 0.109571,0.27928 q 0.429154,1.09382 0.248538,1.72865 -0.189747,0.61155 -0.887933,0.88548 -0.698186,0.27392 -1.253171,-0.0454 -0.564115,-0.34263 -0.993269,-1.43646 l -0.712212,-1.81528 5.492395,-2.1549 -0.913093,-2.32729 z"
                                id="path4750" />
                        <path
                                d="m 78.662865,977.55437 -2.700631,-10.19849 q 0.393747,-0.46633 0.74059,-0.81679 0.346843,-0.35047 0.78185,-0.46566 0.435006,-0.11519 0.76484,0.0561 0.323433,0.14711 0.451425,0.63045 l 2.668633,10.07765 2.706706,-0.71675 -2.783825,-10.51266 q -0.339178,-1.28085 -1.135342,-1.84587 -0.771996,-0.57142 -1.859513,-0.28344 -0.580008,0.15359 -0.983017,0.38962 -0.409408,0.21186 -0.720716,0.50119 -0.311309,0.28933 -0.572852,0.66893 -0.261543,0.37959 -0.600556,0.85729 l -0.345578,-1.30502 -2.561705,0.67836 3.442984,13.00186 2.706707,-0.71675 z"
                                id="path4752" />
                        <path
                                d="m 83.110206,965.04499 1.424266,8.25301 q 0.263595,1.52742 1.22876,2.12194 0.960913,0.56989 2.512971,0.30204 0.517352,-0.0893 0.804479,-0.18957 0.291379,-0.0757 0.549618,-0.19633 l -0.408148,-2.36504 -0.911526,0.15731 q -0.936161,0.16155 -1.123229,-0.92242 l -1.317978,-7.63711 1.847688,-0.31887 -0.391142,-2.26649 -1.847687,0.31886 -0.616474,-3.5722 -2.759213,0.47618 0.616473,3.57219 -1.527422,0.2636 0.391142,2.2665 1.527422,-0.2636 z"
                                id="path4754" />
                        <path
                                d="m 95.726,964.49997 q -0.468819,-1.53833 -1.631434,-2.43497 -1.13772,-0.89893 -2.780693,-0.74682 -0.796593,0.0738 -1.443366,0.40982 -0.649077,0.31116 -1.12805,0.83254 -0.454079,0.51907 -0.690571,1.21886 -0.213904,0.67258 -0.14015,1.46917 0.08528,0.92106 0.523216,1.58351 0.462831,0.66014 1.088393,1.17968 0.650455,0.51724 1.366372,0.92799 0.715917,0.41074 1.329954,0.80582 0.638932,0.39276 1.058431,0.85606 0.442088,0.4361 0.495098,1.00865 0.05301,0.57255 -0.267841,0.90354 -0.320851,0.33099 -0.868509,0.3817 -0.945954,0.0876 -1.401871,-0.49788 -0.433328,-0.61266 -0.636159,-1.44751 l -2.377336,0.89799 q 0.487257,1.73748 1.624978,2.63642 1.135416,0.87405 2.977537,0.70349 0.84638,-0.0784 1.547549,-0.36925 0.701169,-0.29088 1.182447,-0.78736 0.478973,-0.52138 0.690572,-1.21886 0.236492,-0.69978 0.153519,-1.59595 -0.09219,-0.99574 -0.559633,-1.70567 -0.444853,-0.73713 -1.095308,-1.25436 -0.627867,-0.54444 -1.343783,-0.95518 -0.718222,-0.43564 -1.354848,-0.80352 -0.614038,-0.39507 -1.051517,-0.78138 -0.414889,-0.41351 -0.46329,-0.93628 -0.0484,-0.52276 0.249862,-0.82655 0.323156,-0.3061 0.870814,-0.35681 1.294463,-0.11985 1.747608,1.52036 L 95.726,964.49997 Z"
                                id="path4756" />
                    </g>
                </g>
            </svg>
        </div>
    </div>
</div>
<div id="<?php echo $embedid; ?>_rest" class="iv_restdivs">
    <div class="iv_linkbuttons">
        <label class="switch">
            <input type="checkbox" checked>
            <span class="slider"></span>
        </label>
        <svg width="100%" height="100%" viewBox="0 0 64 48" version="1.1" xmlns="http://www.w3.org/2000/svg"
             xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve">
  <g
          transform="translate(1.1717057,-1016.9949)"
          id="layer1">
      <path
              d="m 1.4847057,1020.2831 14.6586693,11.896 14.658671,11.8957 14.65867,-11.8957 14.658669,-11.896 m -58.6346793,15.491 14.6586693,11.8959 14.658671,11.8958 14.65867,-11.8958 14.658669,-11.8959"
              style="opacity:1;fill:none;fill-opacity:1;stroke:#000000;stroke-width:8.43122101;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"
              id="path4136-4" />
  </g>
</svg>
        <div class="tooltip">Autoscroll</div>
    </div>
    <div id="<?php echo $embedid; ?>_commentcontainer" class="iv_commentcontainers"><?php
        if (($options['iv_preloadcomments'] && (!isset($atts['default']) || $atts['default'] == "true")) || ( $atts['preloadc'] == "true" && $atts['default'] == "false")) {
            global $wpdb;

            $comment_tbl = $wpdb->prefix . 'comments';
            $comment_meta_tbl = $wpdb->prefix . 'commentmeta';
            $post_tbl = $wpdb->prefix . 'posts';

            $sql = ("SELECT * FROM (SELECT C.*, CM.*, P.* FROM $comment_tbl C JOIN $comment_meta_tbl CM ON C.comment_ID = CM.comment_id AND C.comment_approved = 1 JOIN $post_tbl P ON P.ID = C.comment_post_ID AND P.ID = $post_obj->ID ORDER BY CAST(CM.meta_value as DECIMAL) ASC)");

            $have_comments = $wpdb->get_results($sql);

            if ($have_comments && $post_obj->post_type == 'iv-video') :
                //the_comments_navigation();
                $c_args = array(
                    'walker' => new comment_walker,
                    'max_depth' => '',
                    'style' => 'ul',
                    'callback' => null,
                    'end-callback' => null,
                    'type' => 'all',
                    'reply_text' => 'Reply',
                    'page' => $post_obj->ID,
                    'per_page' => '',
                    'avatar_size' => 64,
                    'reverse_top_level' => null,
                    'reverse_children' => '',
                    'format' => 'html5',
                    'short_ping' => false,
                    'echo' => false
                );

                $comments = wp_list_comments($c_args, $have_comments);

                print_r($comments);

            endif; //Check for have_comments().

            if (!comments_open() && get_comments_number() && post_type_supports(get_post_type(), 'comments')) {
                echo '<p class="iv_no-comments">';
                _e('Comments are closed.', 'twentysixteen') . '</p>';
            }
        }
        else {?>
            <span class="dashicons dashicons-update loading"></span>
        <?php }
        ?></div>
    <div class="iv_commenterprompts"><div class="prompt">
            <?php
            $cauthor = "";
            $cemail = "";
            $curl = "";
            if (is_user_logged_in()) {
                $cauthor = $current_user->user_login;
                $cemail = $current_user->user_email;
                $curl = $current_user->user_url;
                $note = "Welcome back $cauthor. You can <a href='" . get_edit_user_link() . "'>edit your profile</a> or <a href='" . wp_logout_url(home_url($wp->request)) . "'>logout</a>.";
                $status = "Logged in as";
            } else {
                $status = "Commenting as";
                $curcommenter = wp_get_current_commenter();
                if ($curcommenter['comment_author'] != "") {
                    $cauthor = $curcommenter['comment_author'];
                    $cemail = $curcommenter['comment_author_email'];
                    $curl = $curcommenter['comment_author_url'];
                }

                // Puzzling together the message on top of the commenting field.

                if (get_option('users_can_register') && $options['iv_showlogin'] && get_option('comment_registration')) {
                    $note = "Sorry, you must be logged in to comment. Have an account? Then <a href='" . wp_login_url(home_url($wp->request)) . "'>login</a>. Otherwise <a href='" . wp_registration_url(home_url($wp->request)) . "'>register</a>.";
                } else if (get_option('users_can_register') && $options['iv_showlogin'] && !get_option('comment_registration')) {
                    $note = "Your comments will be published quicker if you <a href='" . wp_registration_url(home_url($wp->request)) . "'>register</a>. Have an account? Then <a href='" . wp_login_url(home_url($wp->request)) . "'>login</a>.";
                } else if (get_option('users_can_register') && !$options['iv_showlogin'] && get_option('comment_registration')) {
                    $note = "Sorry, you must be logged in to comment. Don't have an account? Then <a href='" . wp_registration_url(home_url($wp->request)) . "'>register</a>.";
                } else if (get_option('users_can_register') && !$options['iv_showlogin'] && !get_option('comment_registration')) {
                    $note = "Your comments will be published quicker if you <a href='" . wp_registration_url(home_url($wp->request)) . "'>register</a>.";
                } else if (!get_option('users_can_register') && $options['iv_showlogin'] && get_option('comment_registration')) {
                    $note = "Sorry, you must be logged in to comment. Have an account? Then <a href='" . wp_login_url(home_url($wp->request)) . "'>login</a>.";
                } else if (!get_option('users_can_register') && $options['iv_showlogin'] && !get_option('comment_registration')) {
                    $note = "Your comments will be published quicker if you <a href='" . wp_login_url(home_url($wp->request)) . "'>login</a> to your account.";
                } else if (!get_option('users_can_register') && !$options['iv_showlogin'] && get_option('comment_registration')) {
                    $note = "Sorry, you must be logged in to comment.";
                } else if (!get_option('users_can_register') && !$options['iv_showlogin'] && !get_option('comment_registration')) {
                    $note = "";
                }
            }
            ?>
            <span class="dashicons dashicons-no"></span>
            <p class="commenter-notes"><?php echo $note; ?></p>

            <?php
            // Only display the form if NOT logged in AND NOT comment_registration
            if (!is_user_logged_in() && !get_option('comment_registration')) { ?>
                <p class="cauthors"><label for="cauthor">Name <span class="required">*</span></label>
                    <input id="cauthor" name="author" type="text" value="<?php echo $cauthor; ?>" size="30" maxlength="245" required="required"></p>
                <p class="cemails"><label for="cemail">Email <span class="required">*</span></label>
                    <input id="cemail" name="email" type="email" value="<?php echo $cemail; ?>" size="30" maxlength="100" aria-describedby="email-notes" required="required"></p>
                <p class="curls"><label for="curl">Website</label> <input id="curl" name="url" type="url" value="<?php echo $curl; ?>" size="30" maxlength="200">
                </p>
            <?php }; ?>
        </div></div>
    <div class="iv_commentbars">
        <div class="iv_commentertabs <?php echo $cauthor != "" ? "show" : "";?>"><svg
                    xmlns="http://www.w3.org/2000/svg"
                    viewBox="0 0 24 64"
                    class="roundedcorners_left"
                    version="1.1">
                <path
                        id="path4136"
                        d="m 0,64 c 6.2952754,0 12.243237,-1.303471 12.243237,-9.493414 0,-9.003091 -0.232491,-35.322929 -0.232491,-42.177055 0,-9.3072224 4.12947,-12.3295348146975 11.989255,-12.3295348146975 L 24.000001,64 Z"
                        style="stroke:none;" />
            </svg><svg
                    xmlns="http://www.w3.org/2000/svg"
                    viewBox="0 0 24 64"
                    class="roundedcorners_right"
                    version="1.1">
                <path
                        id="path4136"
                        d="m 0,64 c 6.2952754,0 12.243237,-1.303471 12.243237,-9.493414 0,-9.003091 -0.232491,-35.322929 -0.232491,-42.177055 0,-9.3072224 4.12947,-12.3295348146975 11.989255,-12.3295348146975 L 24.000001,64 Z"
                        style="stroke:none;" />
            </svg>
            <span class="status"><span class="msg"><?php echo $status; ?></span> <span class="cauthors"><?php echo $cauthor; ?></span></span>
        </div>
        <form id="<?php echo $embedid; ?>_commentform" class="iv_commentforms">
            <div class="iv_errorprompts"><span class="moderrors"><?php printf( __( 'You can\'t start a new thread %d seconds before or after a moderated thread.', 'iv' ), $options['iv_moderatorreservetime'] );?></span><span class="limiterrors"><?php _e( 'There are already too many threads in this area. You can respond to existing ones, or comment later.', 'iv' );?></span></div>
            <textarea name="comment" id="<?php echo $embedid; ?>_commentinput" class="commentinputs" type="text" placeholder="Join the discussion!" oninput="this.style.height = '';this.style.height = (this.scrollHeight+2) + 'px';"></textarea>
            <div class="iv_minicontrols">
                <div class="iv_replaybuttons dashicons dashicons-backup"></div>
                <div class="iv_commentstatus dashicons dashicons-testimonial"></div>
            </div>
            <input name="author" value="<?php echo $cauthor; ?>" size="30" maxlength="245"
                   aria-required="true" required="required" type="hidden"/>
            <input name="email" value="<?php echo $cemail; ?>" required="required" type="hidden"/>
            <input name="url" value="<?php echo $curl; ?>" required="required" type="hidden"/>
            <input name="comment_post_ID" value="<?php echo $post_obj->ID; ?>" type="hidden"/>
            <input id="<?php echo $embedid; ?>_formtime" class="iv_formtimes" name="iv_comment_time" value="" type="hidden"/>
            <input name="comment_parent" value="" type="hidden"/>
            <input name="submit" id="submit" class="submit" value="Post Comment" type="hidden" />
        </form>
    </div>
</div>

    <?php
    $out = ob_get_contents();
    ob_end_clean();

    return $out;
}

// Method to handle comment submission
function ajaxComment($comment_ID, $comment_status) {
    // If it's an AJAX-submitted comment
    if(isset($_SERVER['HTTP_X_REQUESTED_WITH']) && strtolower($_SERVER['HTTP_X_REQUESTED_WITH']) == 'xmlhttprequest'){
        // Get the comment data
        $comment = get_comment($comment_ID);
        // Allow the email to the author to be sent
        wp_notify_postauthor($comment_ID, $comment->comment_type);
        // Get the comment HTML from my custom comment HTML function
        $commentContent = getCommentHtml($comment);
        // Kill the script, returning the comment HTML
        die($commentContent);
    }
}
function getCommentHtml($comment) {
    ob_start();
    $options = get_option('iv_options');
    $moderators = $options[moderators];
    $iv_comment_time = get_comment_meta($comment->comment_ID, 'iv_comment_time', true);
    $GLOBALS['comment'] = $comment;
    ?>
    <li <?php if($moderators && in_array($comment->user_id, $moderators)) {
    comment_class("moderatorcomments");
} else {
    comment_class();
}?> data-comment-id="<?php comment_ID() ?>" data-comment-time = "<?php echo  $iv_comment_time; ?>" id="comment-<?php comment_ID() ?>">
    <article  class="iv_commentbodies">
        <div class="gravatars"><?php echo get_avatar($comment, 58); ?></div>
        <div class="iv_commentcontents">
            <div class="iv_comment-byline">
                <span class="iv_comment-authors"><a class="iv_comment-author-link" href="<?php comment_author_url(); ?>" itemprop = "author"><?php comment_author(); ?></a></span><span class="separators">&bull;</span>
                <?php edit_comment_link('<span class="dashicons dashicons-edit"></span> Edit<span class="separators">&bull;</span>','','');
                if($iv_comment_time) { ?>
                    <span class="iv_comment_times"><a href="javascript:void(0)"><span class="dashicons dashicons-controls-play"></span> <?php echo seconds2human($iv_comment_time); ?></a></span><span class="separators">&bull;</span>
                <?php } ?>
                <span class="iv_comment_dates" datetime="<?php comment_date("F j\, Y") ?>T<?php comment_time('H:iP') ?>"><?php comment_date('F j\, Y') ?></span>
            </div>
            <div class="comment-content post-content" itemprop="text">
                <?php comment_text() ?>
            </div>
            <div class="iv_comment-belowline">
                <a class="iv_replylinks"><span class="dashicons dashicons-undo
"></span> Reply</a>
                <span class="separators">&bull;</span>
                <a class="iv_expand_comment_thread"><span class="dashicons dashicons-arrow-down-alt2"></span> Expand<span class="iv_childrencountnumber"></span></a>
            </div>
        </div>
    </article>
</li> <?php
    $out = ob_get_contents();
    ob_end_clean();

    return $out;
}
// Send all comment submissions through my "ajaxComment" method
add_action('comment_post', 'ajaxComment', 20, 2);

// STUFF by Amit that I know I need

add_action('comment_post', 'iv_add_comment_time');
function iv_add_comment_time($comment_id)
{
    add_comment_meta($comment_id, 'iv_comment_time', $_POST['iv_comment_time']);
}

add_action('wp_ajax_update_comment_list', 'get_updated_comments');
add_action('wp_ajax_nopriv_update_comment_list', 'get_updated_comments');
function get_updated_comments()
{

    global $wpdb;

    $post_id = $_POST['post_id'];
    $comment_tbl = $wpdb->prefix . 'comments';
    $comment_meta_tbl = $wpdb->prefix . 'commentmeta';
    $post_tbl = $wpdb->prefix . 'posts';

    $sql = ("SELECT C.*, CM.*, P.* FROM $comment_tbl C JOIN $comment_meta_tbl CM ON C.comment_ID = CM.comment_id AND C.comment_approved = 1 JOIN $post_tbl P ON P.ID = C.comment_post_ID AND P.ID = $post_id ORDER BY CAST(CM.meta_value as DECIMAL) ASC");

    $have_comments = $wpdb->get_results($sql);

    $c_args = array(
        'walker' => new comment_walker,
        'max_depth' => '',
        'style' => 'ul',
        'callback' => null,
        'end-callback' => null,
        'type' => 'all',
        'reply_text' => 'Reply',
        'page' => '',
        'per_page' => '',
        'avatar_size' => 64,
        'reverse_top_level' => null,
        'reverse_children' => '',
        'format' => 'html5',   // or 'xhtml' if no 'HTML5' theme support
        'short_ping' => false,    // @since 3.6
        'echo' => false    // boolean, default is true
    );

    if ($have_comments) :
        echo $comments_list = wp_list_comments($c_args, $have_comments);
    endif;
    wp_die();
}

add_filter('page_template', 'video_page_template');
function video_page_template($page_template)
{
    if (is_page('iv-video-list')) {
        $page_template = dirname(__FILE__) . '/listing-video-template.php';
    }

    return $page_template;
}

function sortByOrder($a, $b)
{
    return $a['iv_comment_time'] - $b['iv_comment_time'];
}

?>